@startuml URL Shortener - System Overview

!theme plain
skinparam linetype ortho

title URL Shortener System - Complete Architecture

package "User Interface" {
  [React Frontend] as UI
  note right of UI
    Features:
    - URL input form
    - Custom slug option
    - Short URL display
    - Copy to clipboard
  end note
}

package "Next.js Application Server" {
  [App Router] as Router
  [API Handler: /api/shorten] as CreateAPI
  [Route Handler: /[slug]] as RedirectHandler
}

package "Business Services" {
  [URL Validation Service] as Validation
  [Slug Generation Service] as SlugService
  [Click Tracking Service] as Tracking
}

package "Data Layer" {
  [Prisma ORM] as ORM
  [Database Connection Pool] as Pool
}

database "PostgreSQL Database" {
  [ShortUrl Table] as Table
  note right of Table
    Columns:
    - id (PK)
    - slug (Unique Index)
    - targetUrl
    - clicks (default: 0)
    - lastAccessedAt (nullable)
    - createdAt
    - updatedAt
  end note
}

UI --> Router : HTTP Requests
Router --> CreateAPI : POST /api/shorten
Router --> RedirectHandler : GET /<slug>

CreateAPI --> Validation : Validate URL format
CreateAPI --> SlugService : Generate unique slug
CreateAPI --> ORM : Create record

RedirectHandler --> ORM : Find by slug
RedirectHandler --> Tracking : Update metrics
RedirectHandler --> UI : HTTP 302 Redirect

Validation --> CreateAPI : Validation result
SlugService --> CreateAPI : Unique slug
Tracking --> ORM : Update clicks & timestamp

ORM --> Pool : Connection management
Pool --> Table : SQL operations

' Styling
skinparam package {
  BackgroundColor #E1F5FF
  BorderColor #01579B
}

skinparam database {
  BackgroundColor #FFF3E0
  BorderColor #E65100
}

@enduml

