@startuml URL Shortener - Data Flow Diagram

!theme plain
skinparam linetype ortho

title URL Shortener - Data Flow

start

:User enters URL\n(and optional slug);

:Frontend sends\nPOST /api/shorten;

:Validate URL format;

if (URL valid?) then (yes)
  if (Custom slug?) then (yes)
    :Use custom slug;
  else (no)
    :Generate random slug\nusing nanoid(8);
  endif
  
  :Check slug uniqueness;
  
  if (Slug exists?) then (yes)
    :Append random suffix;
    :Retry uniqueness check;
  else (no)
    :Create ShortUrl record;
    :Save to database;
    :Return short URL;
    :Display to user;
  endif
else (no)
  :Return error message;
  stop
endif

:User clicks short URL\nor visits /<slug>;

:Find ShortUrl by slug;

if (Found?) then (yes)
  :Increment clicks counter;
  :Update lastAccessedAt timestamp;
  :Save to database;
  :HTTP 302 Redirect\nto target URL;
  :User redirected;
else (no)
  :Return 404 error;
  stop
endif

stop

@enduml

